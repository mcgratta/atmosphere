%  LaTeX support: latex@mdpi.com
%  In case you need support, please attach all files that are necessary for compiling as well as the log file, and specify the details of your LaTeX setup (which operating system and LaTeX version / tools you are using).

%=================================================================
\documentclass[journal,article,atmosphere,submit,moreauthors,pdftex]{Definitions/mdpi}

% If you would like to post an early version of this manuscript as a preprint, you may use preprint as the journal and change 'submit' to 'accept'. The document class line would be, e.g., \documentclass[preprints,article,accept,moreauthors,pdftex]{mdpi}. This is especially recommended for submission to arXiv, where line numbers should be removed before posting. For preprints.org, the editorial staff will make this change immediately prior to posting.

%--------------------
% Class Options:
%--------------------
%----------
% journal
%----------
% Choose between the following MDPI journals:
% acoustics, actuators, addictions, admsci, aerospace, agriculture, agriengineering, agronomy, ai, algorithms, animals, antibiotics, antibodies, antioxidants, applmech, applsci, arts, asc, asi, atmosphere, atoms, axioms, batteries, bdcc, behavsci , beverages, bioengineering, biology, biomedicines, biomimetics, biomolecules, biosensors, brainsci , buildings, cancers, carbon , catalysts, cells, ceramics, challenges, chemengineering, chemistry, chemosensors, children, civileng, cleantechnol, climate, clockssleep, cmd, coatings, colloids, computation, computers, condensedmatter, cosmetics, cryptography, crystals, dairy, data, dentistry, designs , diagnostics, diseases, diversity, drones, econometrics, economies, education, ejbc, ejihpe, electrochem, electronics, endocrines, energies, entropy, environments, epigenomes, est, fermentation, fibers, fire, fishes, fluids, foods, forecasting, forests, fractalfract, futureinternet, futurephys, galaxies, games, gastrointestdisord, gels, genealogy, genes, geohazards, geosciences, geriatrics, hazardousmatters, healthcare, hearts, heritage, highthroughput, horticulturae, humanities, hydrology, ijerph, ijfs, ijgi, ijms, ijtpp, informatics, information, infrastructures, inorganics, insects, instruments, inventions, iot, j, jcdd, jce, jcm, jcp, jcs, jdb, jfb, jfmk, jimaging, jintelligence, jlpea, jmmp, jmse, jne, jnt, jof, joitmc, jpm, jrfm, jsan, land, languages, laws, life, literature, logistics, lubricants, machines, magnetochemistry, make, marinedrugs, materials, mathematics, mca, medicina, medicines, medsci, membranes, metabolites, metals, microarrays, micromachines, microorganisms, minerals, modelling, molbank, molecules, mps, mti, nanomaterials, ncrna, ijns, neurosci, neuroglia, nitrogen, notspecified, nutrients, oceans, ohbm, optics, particles, pathogens, pharmaceuticals, pharmaceutics, pharmacy, philosophies, photonics, physics, plants, plasma, pollutants, polymers, polysaccharides, preprints , proceedings, processes, prosthesis, proteomes, psych, publications, quantumrep, quaternary, qubs, reactions, recycling, religions, remotesensing, reprodmed, reports, resources, risks, robotics, safety, sci, scipharm, sensors, separations, sexes, signals, sinusitis, smartcities, sna, societies, socsci, soilsystems, sports, standards, stats, surfaces, surgeries, sustainability, sustainableworld, symmetry, systems, technologies, telecom, test, tourismhosp, toxics, toxins, transplantology, tropicalmed, universe, urbansci, vaccines, vehicles, vetsci, vibration, viruses, vision, water, wem, wevj

%---------
% article
%---------
% The default type of manuscript is "article", but can be replaced by:
% abstract, addendum, article, benchmark, book, bookreview, briefreport, casereport, changes, comment, commentary, communication, conceptpaper, conferenceproceedings, correction, conferencereport, expressionofconcern, extendedabstract, meetingreport, creative, datadescriptor, discussion, editorial, essay, erratum, hypothesis, interestingimages, letter, meetingreport, newbookreceived, obituary, opinion, projectreport, reply, retraction, review, perspective, protocol, shortnote, supfile, technicalnote, viewpoint
% supfile = supplementary materials

%----------
% submit
%----------
% The class option "submit" will be changed to "accept" by the Editorial Office when the paper is accepted. This will only make changes to the frontpage (e.g., the logo of the journal will get visible), the headings, and the copyright information. Also, line numbering will be removed. Journal info and pagination for accepted papers will also be assigned by the Editorial Office.

%------------------
% moreauthors
%------------------
% If there is only one author the class option oneauthor should be used. Otherwise use the class option moreauthors.

%---------
% pdftex
%---------
% The option pdftex is for use with pdfLaTeX. If eps figures are used, remove the option pdftex and use LaTeX and dvi2pdf.

%=================================================================
\firstpage{1}
\makeatletter
\setcounter{page}{\@firstpage}
\makeatother
\pubvolume{xx}
\issuenum{1}
\articlenumber{5}
\pubyear{2020}
\copyrightyear{2020}
%\externaleditor{Academic Editor: name}
\history{Received: date; Accepted: date; Published: date}
%\updates{yes} % If there is an update available, un-comment this line

%% MDPI internal command: uncomment if new journal that already uses continuous page numbers
%\continuouspages{yes}

%------------------------------------------------------------------
% The following line should be uncommented if the LaTeX file is uploaded to arXiv.org
%\pdfoutput=1

%=================================================================
% Add packages and commands here. The following packages are loaded in our class file: fontenc, inputenc, calc, indentfirst, fancyhdr, graphicx,epstopdf, lastpage, ifthen, lineno, float, amsmath, setspace, enumitem, mathpazo, booktabs, titlesec, etoolbox, tabto, xcolor, soul, multirow, microtype, tikz, totcount, amsthm, hyphenat, natbib, hyperref, footmisc, url, geometry, newfloat, caption

%=================================================================
%% Please use the following mathematics environments: Theorem, Lemma, Corollary, Proposition, Characterization, Property, Problem, Example, ExamplesandDefinitions, Hypothesis, Remark, Definition, Notation, Assumption
%% For proofs, please use the proof environment (the amsthm package is loaded by the MDPI class).

%=================================================================
% Full title of the paper (Capitalized)
\Title{Application of a Cut-Cell Immersed Boundary Method for Wildfire Simulation over Complex Terrain}

% Author Orchid ID: enter ID or remove command
\newcommand{\orcidauthorA}{0000-0000-000-000X} % Add \orcidA{} behind the author's name
%\newcommand{\orcidauthorB}{0000-0000-000-000X} % Add \orcidB{} behind the author's name

% Authors, for the paper (add full first names)
\Author{Marcos Vanella $^1$, Kevin McGrattan $^1$, Randall McDermott $^1$, Glenn Forney $^1$, and William Mell $^2$}

% Authors, for metadata in PDF
\AuthorNames{Marcos Vanella, Kevin McGrattan, Randall McDermott, Glenn Forney, and William Mell}

% Affiliations / Addresses (Add [1] after \address if there is only one affiliation.)
\address{%
$^{1}$ \quad National Institute of Standards and Technology, Gaithersburg, Maryland, USA \\
$^{2}$ \quad U.S. Forest Service, Seattle, Washington, USA}

% Contact information of the corresponding author
\corres{Correspondence: marcos.vanella@nist.gov}


\abstract{A method for the large-eddy simulation (LES) of wildfire spread over complex terrain is presented. In this scheme, a cut-cell immersed boundary method (CC-IBM) is used to render the complex terrain, defined by a tessellation, on a rectilinear Cartesian grid. Discretization of scalar transport equations for chemical species is done via a finite volume scheme on cut-cells defined by the intersection of the terrain geometry and the Cartesian cells. Momentum transport and heat transfer close to the immersed terrain are handled using dynamic wall models and a direct forcing immersed boundary method. Further, atmospheric wind conditions are specified using a mean forcing concept. Fire spread is modeled using one of three basic approaches: (1) representing the vegetation as a collection of Lagrangian particles, (2) representing the vegetation as a semi-porous boundary, and (3) representing the fire spread using a level set method in which the fire spreads as a function of terrain slope, vegetation type, and wind speed. Several test and validation cases are reported to demonstrate the capabilities of this novel wildfire simulation methodology.}

\keyword{complex terrain; fire spread; immersed boundary method; level sets}


\begin{document}


\section{Introduction}

% Motivation.
In the last decades, wild land and wild land-urban interface (WUI) fires have received substantial attention due to their destructive nature and extensive cost in lives and property~\cite{thomas_2017,mcdermott_2019,boghani_2019,richards_2020}. Over the years, modeling and simulation activities of such phenomena have been tailored to the needs of planners, scientists and first responders, and by the available computing capabilities.
% Wildfire modeling in the literature.
A large body of literature can be found on the subject. See for example reviews~\cite{Papadopoulos_2011,Bakhshaii_2019,mcdermott_2019} on classical and new models with associated software. Due to inherent complex nature of the problem, most models of wildfires have historically relied on simplified field-tested rules and correlations.

Among these, the fire spread model by Rothermel~\cite{Rothermel:1972} assumes quasi-steady state ground fire conditions and takes as inputs fuel properties, wind, terrain slope and moisture that can be measured in situ.
Fuel models have been cataloged~\cite{Anderson:1982}, and their input parameters defined in a manner the user can select and combine the most appropriate listed fuels for her case of study. Rothermels fire line model is a widely used wildfire spread model, and has been implemented in several simulation tools~\cite{Finney:FARSITE,Bova:IJWF2015,mcgratta_2013} \textbf{OTHERS?}, enabling a range of planning and operational forecasting capabilities.

% Level set as a simplified fire spread model, operational forecasting.
Evolution of wild land fires is usually tied to a fire front, which can have a complex shape moving/deforming with the local flame spread velocities. Knowing the location of this fire front and local properties of the fire, fuel and terrain allows, by use of simplified models like Rothermels, to predict local ignition and fire spread. When modeling the problem numerically, identifying such fire front at a given moment in time requires a mathematical representation and an associated discretization or mesh. The Lagrangian treatment of the motion of a fire front requires specifying a set of control markers and connectivity that define and move with such front. Therefore, the fire front is represented by this discrete mesh. For example, if the domain of motion is a surface terrain, this Lagrangian mesh can be a polygon that moves with the front along this surface~\cite{Finney:FARSITE,Bova:IJWF2015}.
On the other hand, an Eulerian representation of motion allows for the mesh to be fixed in space (i.e. in a terrain a polygonal patch mesh of said terrain). Then, the location of the fire front can be portrayed implicitly by using a scalar field defined in the fixed two dimensional mesh. This scalar field is called level set function and numerical methods that evolve it in time are called Level Set Methods (LSM)~\cite{Sethian:1999,Osher:2006}. Some wildfire solvers that use LSM to track the fire front are described in references~\cite{coen_2013,Bova:IJWF2015,mcgratta_2013,LAUTENBERGER_2013}. A practical comparison of the two techniques as implemented in WFDS~\cite{Mell:IJWF2007} and FARSITE~\cite{Finney:FARSITE} is provided in reference~\cite{Bova:IJWF2015}.

% Resolving the flow features on terrains using LES over complex terrains. Describe what we do, FDS, cut-cell schemes, immersed boundary methods.
As the rate of spread of the front line is dependent in the local velocity on empirical fire spread models like Rothermels, a better local resolution of the velocity field around complex terrains should be beneficial to the accuracy of the overall model. In reality, besides the obstructive character of the terrain itself, compounded effects due to the fire affect the local velocity field. \textbf{Some of these are ...}.
The de facto physics-based technique for practical simulation of outdoor flows is Large Eddy Simulation (LES)~\cite{coen_2013,mcgratta_2013}. Within FDS~\cite{mcgratta_2013},  the filtered Navier-Stokes equations for buoyant, combusting flows are evolved using a Low Mach approximation. Chemical species are handled using scalar transport equations. Energy transport is accounted for by means of the solution of radiative transport equations and a thermodynamic divergence proxy. \textbf{Comment on WFDS for LOF. The work of Mell et al.~\cite{Mell:IJWF2007}.}.

% Unstructured geometries, capability can be tuned for use with LOF and fire spread models.
% What has been done, cut-cell scheme IBM, connection to LS and Rothermels, wind.
Lately, substantial work has been done to add to FDS the option of simulating flows around unstructured geometries. These are represented by surface triangulations which is a typical representation in computer aided design (CAD) and simulation software. This added flexibility is still compliant with the structured cartesian grids and differentiation schemes within FDS. We implemented a cut-cell scheme~\cite{berger_2016} to advance the scalar transport and energy of multicomponent mixtures on the polyhedra next to the geometries. These polyhedrons arise from geometry intersection with the cartesian fluid grid. As geometry boundaries are not changed, the method has the property of exact volume and area conservation. Velocities next to geometries are reconstructed using an immersed boundary method (IBM)~\cite{fadlun_2000,balaras_2004} coupled with an equilibrium wall model for turbulent flows~\cite{mcdermo_2018}. Variables related to IBM forcing and heat transfer modeling at the wall are sampled through interpolation and a normal probe approach~\cite{balaras_2004}. Also, radiation transport boundary conditions have been adapted to this technique.
For fire simulation over complex terrains a range of options in terms of physics fidelity of the model are being developed, in particular, in the representation of fire spread. For fast simulation of outdoor fires, this new capability has been interfaced with a Level Set scheme~\cite{Bova:IJWF2015} and Rothermels fire spread model. The wind speed input for Rothermels model results from the local velocity over the terrain which is affected by fire buoyancy and flow evolution. These are in turn also influenced by wind atmospheric conditions, accounted for within simulations using a mean wind forcing concept.

% Outline of the manuscript.
In the following section a description on the mathematical model for fire over terrain is provided. The terrain description and model discretization is provided in section~\ref{sec:terraindisc}. An account of the fire spread model is given in section~\ref{sec:firespread}, as well as the wind atmospheric boundary conditions in section~\ref{sec:wind}. Numerical experiments testing the methodology on a simple example and a real case of fire in Cogoleto, Italy are provided in section~\ref{sec:numexp}. Finally a summary of this work is outlined in section~\ref{sec:summary}.


\section{Mathematical model} \label{sec:matmodel}

For fire modeling on the gas phase, FDS employs a Low Mach approximation for thermally driven buoyant and stratified flows~\cite{Rehm:1}. Under this assumption the pressure field $p$ can be viewed as the summation of two components: a background pressure $\overline{p}(z,t)$ used on the equation of state (the ideal gas law is used), and a hydrodynamic pressure $\tilde{p}(x,y,z,t)$ resulting from fluid motion.

Consider a mixture composed of $N$ chemical species $\alpha$, moving on a fixed point $\mathbf{x}$ in space with a mass weighted average velocity $\mathbf{u}(\mathbf{x},t)$. If $\rho(\mathbf{x},t)$ is the mixture density, the mass fraction for species $\alpha$ is $Y_\alpha = \rho_\alpha / \rho$, were $\rho_\alpha(\mathbf{x},t)$ is the species density for the local thermodynamic conditions. The scalar transport and momentum equations take the form:
\begin{eqnarray}
   \frac{\partial \rho Y_\alpha}{ \partial t} + \nabla \cdot ( \mathbf{J_{c}}_\alpha ) &=& - \nabla \cdot (\mathbf{J_{d}}_\alpha) + \dot{m}_\alpha'''  +
    \dot{m}_{b,\alpha}'''\; , \; \alpha=1,\dots,N \label{eqn:spectran} \\
    \frac{\partial \mathbf{u}}{\partial t} - \mathbf{u} \times \boldsymbol{\omega} + \nabla H - \tilde{p} \, \nabla \left( 1/\rho\right) &=&
    \frac{1}{\rho} \left[ (\rho-\rho_0) \mathbf{g} + \mathbf{f}_{b} + \nabla \cdot \boldsymbol{\tau} \right] \label{eqn:momtran}
\end{eqnarray}
where $\mathbf{J_{c}}_\alpha=\rho Y_\alpha  \mathbf{u}$, $\mathbf{J_{d}}_\alpha=- \rho D_\alpha \boldsymbol{\nabla} Y_\alpha$ are the convective and diffusive fluxes for component $\alpha$. Ficks Law for binary diffusion respect to a background species is assumed, $D_\alpha$ is the diffusivity of $\alpha$ respect to the background species, $\dot{m}_\alpha'''(\mathbf{x},t)$ is the combustion volumetric source for species $\alpha$ and $ \dot{m}_{b,\alpha}'''$ is the contribution to species $\alpha$ from sub-grid particles gasification. Also, in the momentum equation the head $H=|\mathbf{u}|^2/2 + \tilde{p}/\rho$, and $\tilde{p}$ is the perturbation pressure, $\rho_0(z)$ is an equlibrium density, $\mathbf{g}=(0,0,g_z)$ gravity vector, $\mathbf{f}_{b}$ is the particle force term and $\boldsymbol{\tau}$ tensor accounting for molecular and sub-grid turbulent stresses parameterized by an eddy viscosity model. This last model is employed by default in large eddy simulation (LES) of outdoor fires. Details of the model equations and their derivation are found in reference~\cite{mcgratta_2013tr}.

Further, the flow field is subjected to the following divergence constraint:
%
\begin{eqnarray}
    ( \nabla \cdot \mathbf{u} )^{th} &=&
    \left[ \frac{1}{\rho c_p T} - \frac{1}{\bar{p}} \right]
    \frac{\partial \bar{p}}{\partial t} + \frac{w \rho_0 g_z}{\rho c_p T} \nonumber \\
    &+& \frac{1}{\rho c_p T} \left[ \dot{q}''' + \dot{q}_b''' - \nabla \cdot \dot{\mathbf{q}}'' - \mathbf{u} \cdot \nabla (\rho h_s) \right] \nonumber \\
    &+& \frac{1}{\rho} \sum_\alpha \left( \frac{\overline{W}}{W_\alpha} - \frac{h_{s,\alpha}}{c_p T} \right) \left[ \dot{m}_\alpha'''  + \dot{m}_{b,\alpha}''' - \nabla \cdot (\mathbf{J_{d}}_\alpha) - \mathbf{u} \cdot \nabla (\rho Y_\alpha) \right] \label{eq:divth}
\end{eqnarray}
%
where $h_s$ is the local sensible enthalpy, $\dot{q}''', \dot{q}_b'''$ are heat release rates due to combustion and particle gasification, $\dot{\mathbf{q}}''$ is the heat flux, sum of conduction, convection and radiation, and $T$ is the local temperature. The mixture specific heat at constant pressure and molecular weight are $c_p=\sum_{\alpha =1}^N{c_{p,\alpha} Y_\alpha}$ and $\overline{W}=\left(\sum_{\alpha =1}^N{Y_\alpha /W_\alpha} \right)^{-1}$ respectively, built from the individual species counterparts as defined. Finally, $w,\rho_0,g_z$ on the stratification term are respectively, the local vertical velocity, density for standard conditions (depends on vertical coordinate), and vertical gravity acceleration. This thermodynamic divergence is derived from and acts as a proxy for the sensible enthalpy evolution equation~\cite{mcdermo_2014}. Being $R$ the ideal gas constant, problem is closed with the ideal gas law $ \overline{p} = {\rho R T}/{\overline{W}}$.

% Fire spread model equations.
As commented in the introduction, the location of a fire front can be defined implicitly along the terrain surface through the zero of a two dimensional level set scalar function $\phi(x,y,t)$. This implicit form can be used to define and advection equation for the level set function:
%
\begin{equation}
   \frac{D \phi(x,y,t)}{D t} =  \frac{\partial \phi}{\partial t} + \mathbf{R}_{uv} \cdot \nabla (\phi) = 0 \label{eqn:lset}
\end{equation}
%
where $\mathbf{R}_{uv}=(R_u,R_v)$ is the rate of spread vector along the terrain plane. The magnitude of the rate of spread vector is computed by $|\mathbf{R}_{uv}|=R_0 \left(1 + \sqrt{(\boldsymbol{\phi}_W+\boldsymbol{\phi}_S) \cdot (\boldsymbol{\phi}_W+\boldsymbol{\phi}_S) } \right)$, being $R_0$ the zero velocity and zero slope rate of spread (baseline, dependent of fuel properties), and vectors $\boldsymbol{\phi}_W,\boldsymbol{\phi}_S \ge 0$ are computed using local wind, slope through empirical rules~\cite{Wilson:1980}. See Appendix 1 of reference~\cite{Bova:IJWF2015} for details on these calculations, as implemented in WFDS-LS and in this work.


\section{Terrain description and discretization} \label{sec:terraindisc}


% How do we describe terrains - geometries. Methodology to get from DEM a geometry.
%
In figure~\ref{Fig:figure_1}a, a terrain is represented by its surface triangulation within an FDS cartesian mesh. Some cartesian cells and faces belonging to this mesh are transversed by the terrain surface. The remainder polyhedra and polygons that lay on the gas side of this intersected cartesian entities are called cut-cells and cut-faces. They discretize the fluid domain in the region surrounding the solid terrain. A detail of this unstructured mesh is. shown in figure~\ref{Fig:figure_1}b. The resulting cut-cells and cut-faces are of varied sizes and shapes, and situations where more than one cut-cell per cartesian cell are not uncommon. As described later, small cells pose a temporal stability constraint in explicit time integration schemes that needs to be addressed.
It is noted that a two level of refinement grid hierarchy emerges. The coarse level is defined by the Cartesian entities, whereas the fine level is defined by the cut-cell or unstructured counterparts. Methods that solve discrete model equations on these grids are called cut-cell or embedded boundary methods~\cite{berger_2016}. Reliably defining the cut-cell mesh geometric properties and topology is a complex problem on itself, omitted here in order to keep the discussion succinct.
%
\begin{figure}[h]
   \centering
   \includegraphics[trim = 12mm 42mm 8mm 25mm, clip,width=1\linewidth]{./figures/SketchFig1.pdf}
   \put(-305,-5){(a)}
   \put(-95,-4){(b)}
   \caption{Sketch of regular Cartesian and cut-cell grids around terrain: (a) An unstructured cut-cell region is defined on the gas phase side around a terrain $\mathbf{T}$. (b) Detail showing a slice representative of cut-cells and regular gas cells, terrain triangulation and two refinement level interpretation.}
   \label{Fig:figure_1}
\end{figure}
%

\subsection{Scalar transport and energy discretization in unstructured region}

The equations for chemical species transport are discretized using the finite volume method (FV)~\cite{eymard_2000,leveque_2002}. See figure~\ref{Fig:figure_2}a. Integrating equation~\eqref{eqn:spectran} over a cut-cell $ii$ with control volume $\Omega_{ii}$:
%
\begin{equation}
 \int_{\Omega_{ii}} {\frac{\partial \rho Y_\alpha}{\partial t}} d \Omega + \int_{\Omega_{ii}} { \boldsymbol{\nabla} \cdot  \left(  \rho Y_\alpha \mathbf{u} \right)
      } d \Omega  = -\int_{\Omega_{ii}} { \boldsymbol{\nabla} \cdot \left(  \mathbf{J_{d}}_\alpha  \right)  } d \Omega + \int_{\Omega_{ii}} {( \dot{m}_\alpha'''+\dot{m}_{b,\alpha}''') } d \Omega \label{eq:intconvdiff}
\end{equation}
%
For a control volume that does not change with time, the time derivative and source terms are approximated by
%
\begin{eqnarray}
  \int_{\Omega_{ii}} {\frac{\partial \rho Y_\alpha}{\partial t}} d \Omega & = & \frac{\partial}{\partial t} \int_{\Omega_{ii}} {\rho Y_\alpha} d \Omega
  = \frac{\partial \widetilde{\rho \: Y_\alpha }_{ii}}{\partial t} V_{ii} \\
  \int_{\Omega_{ii}} {( \dot{m}_\alpha''' +\dot{m}_{b,\alpha}''')} d \Omega & = & (\widetilde{ \dot{m}_\alpha''' }_{ii}+ \widetilde{\dot{m}_{b,\alpha}'''}_{ii}) V_{ii} \label{eq:intcons}
\end{eqnarray}
%
where $V_{ii}$ is the volume of cell $ii$ and tildes imply cell averages. In the following the notation is simplified by dropping tildes, observing that quantities are cell or face averaged. Consider the FV discretization of the diffusive term (eqn.~\eqref{eq:intconvdiff}) on cut-cell $ii$ of figure~\ref{Fig:figure_2}a:
%
\begin{equation}
\int_{\Omega_{ii}} { \boldsymbol{\nabla} \cdot \left(  \mathbf{J_{d}}_\alpha  \right)  } d \Omega =
    \int_{\partial \Omega_{ii}} { \left( - \rho D_\alpha \boldsymbol{\nabla} Y_\alpha \right) \cdot \hat{\mathbf{n}}_{ii} } \: d \partial \Omega = \sum^{nf_c}_{k=1}
    \left( - \rho D_\alpha \boldsymbol{\nabla} Y_\alpha \right)_k \cdot \hat{\mathbf{n}}_{ii,k} \: A_k \label{eq:discfvdiffcc}
\end{equation}
%
The integral over the cut-cell volume has been transformed in an area integral on its $nf_c=5$ faces using the divergence theorem. As these $k$ faces with areas $A_k$ and normals out of the control volume $\hat{\mathbf{n}}_{ii,k}$ are planar by construction, the method for evaluation of their mean diffusive fluxes $\left( - \rho D_\alpha \boldsymbol{\nabla} Y_\alpha \right)_k$ will define the spatial accuracy of the discretization. A centroid to centroid (i.e. $\Delta x_{cc}$ in figure~\ref{Fig:figure_2}a) finite differences and linear interpolation are used to approximate $\boldsymbol{\nabla} Y_\alpha$ and $\rho D_\alpha$ for each face belonging to the gas phase. Also, a normal probe approach~\cite{balaras_2004} is employed to sample information from the fluid to define fluxes in boundary cut-faces.
%
\begin{figure}[h]
   \centering
   \includegraphics[trim = 30mm 42mm 35mm 45mm, clip,width=1\linewidth]{./figures/SketchFig2.pdf}
   \put(-335,-5){(a)}
   \put(-95,-4){(b)}
   \caption{Sketch of cut-cell and faces: (a) Cut-cell $ii$ surrounded by gas phase regular and cut-faces (3-5), and boundary cut-faces (1-2).  (b) Interpolation sketch for wall modeled immersed boundary reconstruction of cut-face velocities.}
   \label{Fig:figure_2}
\end{figure}
%

Similarly, the discretization of the advective term is:
%
\begin{equation}
    \int_{\Omega_{ii}} { \boldsymbol{\nabla} \cdot  \left(  \rho Y_\alpha \mathbf{u} \right)} d \Omega =
     \int_{\partial \Omega_{ii}} { \left( \rho Y_\alpha \mathbf{u} \right) \cdot \hat{\mathbf{n}}_{ii} } \: d \partial \Omega =
     \sum^{nf_c}_{k=1} \left( \rho Y_\alpha \mathbf{u} \right)_k \cdot \hat{\mathbf{n}}_{ii,k} \: A_k \label{eq:discfvadvcc}
\end{equation}
%
where the advective flux for face $k$ is $\left( \rho Y_\alpha \mathbf{u} \right)_k = \overline{[\rho Y_\alpha]}_k \mathbf{u}_k$, and the over bar in $\overline{[\rho Y_\alpha]}_k$ means it is a flux limited interpolation to the cut-face~\cite{mcgratta_2013}. In the cut-cell region we use Godunov interpolation for the advective term. As the time integration scheme in FDS is an explicit Runge-Kutta (RK2) method, all variables in the right hand side of equations~\eqref{eq:discfvdiffcc}-\eqref{eq:discfvadvcc} are assumed known. The FV counterpart of the thermodynamic divergence expression for cut-cell $ii$ is:
%
%
\begin{eqnarray}
    ( \nabla \cdot \mathbf{u} )_{ii}^{th} \; V_{ii} &=&
    \left[ \frac{1}{(\rho c_p T)_{ii}} - \frac{1}{\bar{p}_{ii}} \right]
    \frac{\partial \bar{p}_{ii}}{\partial t} \; V_{ii} +
    \frac{w_{ii} \: \rho_0 g_z}{(\rho c_p T)_{ii}} V_{ii} \nonumber \\
    &+& \frac{1}{(\rho c_p T)_{ii}} \left[ (\dot{q}'''+ \dot{q}_b''')_{ii} V_{ii} -
    \sum_{k=1}^{nf_c} \dot{\mathbf{q}}''_{ii,k} \cdot \hat{\mathbf{n}}_{ii,k} \: A_k
    - \overline{\mathbf{u} \cdot \nabla (\rho h_s)} V_{ii} \right]  \\
    &+& \frac{1}{\rho_{ii}} \sum_\alpha \left( \frac{\overline{W}}{W_\alpha} - \frac{h_{s,\alpha}}{c_p T} \right)_{ii} \left[ (\dot{m}_\alpha'''+\dot{m}_{b,\alpha}''')_{ii} V_{ii} -
    \sum_{k=1}^{nf_c} \mathbf{J}_{\alpha,ii,k} \cdot \hat{\mathbf{n}}_{ii,k} \: A_k
    - \overline{\mathbf{u} \cdot \nabla (\rho Y_\alpha)} V_{ii} \right] \nonumber \label{eq:divth2}
\end{eqnarray}
%
where the over line terms refer to flux limited interpolation of corresponding scalars and terms defined with subscript $ii$ refer to cell defined quantities. All heat and mass fluxes and scalars are assumed known. Also, the vertical velocity $w_{ii}$ is interpolated to the cut-cell centroid. Details of the FDS time integration scheme can be found in references~\cite{mcgratta_2013,mcdermo_2014}. For each RK2 substep, the species transport equations are advanced in all FDS cartesian cells, and then the solution (explicit fluxes and scalar densities) recomputed on the unstructured cut-cell region. A similar procedure is done for the thermodynamic divergence.
% Small cell linking for explicit time integration.
As an explicit time integrator is used, in general there will arise cut-cells whose small-size will penalize severely the time step. For these we link their unknown number to larger surrounding cells, which in turn defines mathematically an evolution equation for the union of both linked cells. Cell linking in the context of momentum equations can be found in reference~\cite{kirk_2003}.
In FDS, the momentum equations and pressure Poisson equation are solved in the cartesian mesh. Therefore, an immersed boundary method is used to reconstruct velocities in the cut-cell region. A divergence integral equivalence argument is used to transfer the the divergence from cut-cells to under laying cartesian cells, and build the source of the Poisson equation for the pressure.


\subsection{Immersed boundary method on cut-cell region and wall modeling}

Collecting advective, shear stress and force terms in $\mathbf{F}(\mathbf{u},\mathbf{x},t)$ within equation~\ref{eqn:momtran}, the model momentum transport problem can be casted as~\cite{mcgratta_2013}:
%
\begin{eqnarray}
  \frac{\partial \mathbf{u}(\mathbf{x},t)}{\partial t} &=& - \left[ \mathbf{F}(\mathbf{u},\mathbf{x},t) + \boldsymbol{\nabla} H(\mathbf{x},t) \right ]\label{eq:LowMachMom} \\
         \nabla \cdot \mathbf{u} (\mathbf{x},t) & = & \left(\nabla \cdot \mathbf{u} \right)^{th} \label{eq:LowMachDiv}
\end{eqnarray}
%
where equation~\eqref{eq:LowMachMom} is the momentum equation, subject to a specified divergence field, provided by equation~\eqref{eq:divth}.
Boundary conditions are prescribed for $\mathbf{u}(\mathbf{x},t)$ on boundaries, including the immersed terrain.
%Classical fractional step methods for time integration of incompressible or low Mach flow are based on two operations: First, momentum transport to obtain intermediate velocities, and second, projection of velocities into a target divergence space.
The previous equations are advanced in time using a fractional step method. As illustration, consider their Forward Euler (FE) update from $t_n$ to $t_{n+1}=t_n + \Delta t$. Given $ \mathbf{u}^n=\mathbf{u}(\mathbf{x},t_n)$, $\nabla \cdot \mathbf{u}^{n+1} = \left( \nabla \cdot \mathbf{u}^{n+1} \right)^{th}$ known
%
\begin{eqnarray}
  \frac{\mathbf{u}^{n+1}-\mathbf{u}^{n}}{\Delta t} &=& - \left[ \mathbf{F}^n +  \boldsymbol{\nabla} H^n \right] \label{eq:LowMachMomEu}\\
  \nabla \cdot \mathbf{u}^{n+1} &=& \left( \nabla \cdot \mathbf{u}^{n+1} \right)^{th} \label{eq:LowMachDivEu}
\end{eqnarray}
%
where $\mathbf{u}^{n+1}$ represents a numerical solution at time $t_{n+1}$. This discrete FE update corresponds to the first sub-step of the FDS explicit RK2 integrator. As the potential field $H(\mathbf{x},t)$ does not have a time evolution equation, it is assumed responsible of enforcing the divergence condition and used on the projection step. Taking the divergence of equation~\eqref{eq:LowMachMomEu} and considering  the constraint~\eqref{eq:LowMachDivEu}, the two steps of the method are
%
\begin{enumerate}
  \item Solve Poisson equation for $H^n$:

\begin{equation}
   \nabla \cdot \boldsymbol{\nabla} H^n = - \left[ \frac{\left( \nabla \cdot \mathbf{u}^{n+1} \right)^{th} - \nabla \cdot \mathbf{u}^{n}}{\Delta t} \right] - \nabla \cdot \mathbf{F}^n \label{it:FSPoisson}
\end{equation}

  \item Obtain final velocity for step:

  \begin{equation}
     \mathbf{u}^{n+1} = \mathbf{u}^{n} - \Delta t \left[ \mathbf{F}^n +  \boldsymbol{\nabla} H^n \right] \label{it:FSProject}
   \end{equation}

   %The term $\hat{\mathbf{u}}^{n+1}=\mathbf{u}^{n} - \Delta t \mathbf{F}^n$ is known as intermediate velocity, and is a non divergence matching approximation to $\mathbf{u}^{n+1}$ (i.e. $\nabla \cdot \hat{\mathbf{u}}^{n+1} \neq \left( \nabla \cdot \mathbf{u}^{n+1} \right)^{th}$).
\end{enumerate}
%
A consequence of the projection scheme is that boundary conditions are required on the Poisson equation of step~\eqref{it:FSPoisson}. For explicit methods and stationary \textit{solid} boundaries, the corresponding boundary condition is \textit{homogeneous} Neumann for $H^n$ in $\partial \Omega,\partial \Omega_1,...,\partial \Omega_{nbods}$~\cite{perot_1993}.
Next, an approximation to the no-slip boundary condition at the immersed terrain surface is needed. To this end, a direct forcing immersed boundary method (IBM) for the momentum equations~\cite{fadlun_2000} is employed. A force field is computed on the discrete momentum equations on grid faces crossed by the immersed surfaces to approximate the no-slip boundary condition on these. In LES, the surrounding velocity field is modeled using an equilibrium boundary layer solution.

In figure~\ref{Fig:figure_2}b the velocity update in each of the gas phase cut-face centroids $d$ is done individualizing the point $B$ on the boundary and normal direction through these. Also, and external point $e_x$ through the normal $\mathbf{\hat{n}}$ is defined at a distance $\delta_{ex}$, of the order of the cartesian cells size. Known velocities and fluid parameters are interpolated from the surrounding fluid points $e_1,\dots,e_4$ to $e_x$.
This information is used to estimate a target velocity at step $n+1$, $\mathbf{\hat{u}}_d^{n+1,k-1}$ at point $d$, assuming the log law equilibrium boundary layer solution~\cite{mcgratta_2013}. The target velocity $\hat{u}_d^{n+1,k-1}$ component on the cut-face centroid is flux matched to the under-laying cartesian face $E$ velocity component $\hat{u}_E^{n+1,k-1}$. Finally, an immersed boundary force
%
\begin{equation}
F_E^k=-\frac{\hat{u}_E^{n+1,k-1}-u_E^{n}}{\Delta t} - \frac{\partial H^{n,k-1}}{\partial x}
\label{eq:FIBM}
\end{equation}
%
can be computed and used in equation~\eqref{it:FSPoisson} to take into account the presence of the body. The index $k$ refers in this context to the subiteration that can be performed in the IB force~\eqref{eq:FIBM} and projection~\eqref{it:FSPoisson}-\eqref{it:FSProject} to match final velocities with the wall modeled targets.


\section{Wildland Fire Spread} \label{sec:firespread}

There are various ways of simulating wildland fire spread depending on the resolution of the underlying numerical grid. 
\begin{enumerate}
\item {\bf Particle Model:} The vegetation is represented by a collection of Lagrangian particles that are heated via convection and radiation. This model is appropriate for grid resolution of the order of 1~m or less.
\item {\bf Boundary Fuel Model:} Ground vegetation is modeled like a porous solid with a thickness equal to the height of the vegetation. This model is appropriate for grid resolution of the order of 1~m to 10~m.
\item {\bf Level Set Method:} The fire front propagates using purely empirical rules. This model is appropriate for grid resolution of the order of roughly 10~m and greater. 
\end{enumerate}
The Particle Method and Boundary Fuel Model require thermo-physical properties of the vegetative fuels and the fire spread rate is {\em predicted} by the model. The Level Set Method relies on a set of experimentally-determined spread rates for different types of vegetation and wind speeds.

\subsection{Particle Model}

Lagrangian particles can be used to represent different types of vegetation, like leaves, grass, and so on. In the model each type of vegetation is represented by a single particle in each computational grid cell. Most often the particle is assumed to be cylindrical in shape. The particle is assigned a diameter based on the measured surface area to volume ratio, $\sigma$. The length is relatively unimportant so long as it is assumed to be much greater than the diameter. Material properties are assigned for the wet vegetation which is assumed to dry, decompose to char, and then exothermally oxidize when exposed to heat from an oncoming fire. The drag force exerted by the collection of particles is given by:
\begin{equation}
   \mathbf{f}_{\rm b} = \frac{\rho}{2} \, C_{\rm d} \, C_{\rm s} \, \beta \, \sigma \, \mathbf{u} \, ||\mathbf{u}||
   \label{drag}
\end{equation}
where $\rho$ is the air density, $C_{\rm d}$ is the drag coefficient, $C_{\rm s}$ is the shape factor (ratio of projected area to surface area), $\beta$ is the packing ratio, $\sigma$ is the surface area to volume ratio, and $\mathbf{u}$ is the air velocity. The diameter is specified via the surface area to volume ratio, $\sigma=2/r$ for a cylinder. The packing ratio is the volume of solid needles divided by the volume they occupy, typically denoted $\beta$. It is calculated by dividing the dry mass of vegetation per unit volume, the so-called ``bulk density,'' by the density of the dry vegetation, $\rho_{\rm d}$.

A coniferous tree (e.g. pine, spruce, fir) can be represented in FDS as a collection of Lagrangian particles forming a large cone. The trunk and heavier branches are typically neglected.


\subsection{Boundary Fuel Model}

In many simulations of wildland fire, the ground vegetation layer is too shallow to be resolved explicitly, as is done when using Lagrangian particles to represent the vegetation. In such cases, the ground vegetation can be modeled as a porous boundary consisting of a layer of dry vegetation, moisture, and air, underneath of which is hard ground~\cite{Perez-Ramirez:FT2017}. The drag exerted by the vegetation is modeled using a special velocity boundary condition, and convective heat transfer is modeled via a source term in the one-dimensional heat conduction equation that is solved through the layer of vegetation and solid ground. Thermal radiation penetrates the vegetation layer via a 1-D radiative transport equation that is used for semi-transparent solids.

The Boundary Fuel and Particle Models share the same basic input parameters and pyrolyis model. The drag exerted on the wind flowing through the vegetation is imposed as a force term in the gas phase grid cell adjacent to the boundary:
\begin{equation}
    \mathbf{f}_{\rm b} = \frac{\rho}{2} \, C_{\rm d} \, C_{\rm s} \, \beta \, \sigma \, \frac{h_{\rm b}}{\delta z} \, \mathbf{u} \, ||\mathbf{u}||
\end{equation}
where the parameters are the same as in Eq.~(\ref{drag}) except for the additional depth of vegetation, $h_{\rm b}$, height of a grid cell, $\delta z$, and $\mathbf{u}$ is the gas velocity in the first grid cell.

Thermal radiation is absorbed in depth according to a 1-D radiative transport solver. The absorption coefficient is given by:
\begin{equation}
   \kappa = C_{\rm s} \, \sigma \, \beta
\end{equation}
Thermal convection is not imposed at the interface between the gas phase and the vegetation layer, but rather is imposed via a source term in the 1-D heat conduction solver:
\begin{equation}
   \langle \dot{q}_{\rm c,b}''' \rangle = \sigma \, \beta \, \dot{q}_{\rm c}'' \quad ; \quad \dot{q}_{\rm c}'' = h \, (T_{\rm g} - T_{\rm s}) \quad \hbox{W/m}^2 \quad ; \quad  h = \frac{k}{L} \, {\rm Nu}
\end{equation}
where $\dot{q}_{\rm c}''$ the convective heat transferred to a small, cylindrical solid under the assumption that the subgrid-scale vegetation is cylindrical and the gas velocity and temperature are taken from the first gas phase grid cell adjacent to the boundary.


\subsection{Level Set Model}

For simulations of wildland fires spanning large areas that cannot be gridded finely enough to predict fire spread using a physics-based model, there is an empirical model built based on level sets~\cite{Bova:IJWF2015}. The methodology reproduces in an Eulerian framework the approach used in the Lagrangian-based fire front-tracking model FARSITE~\cite{Finney:FARSITE}. This approach makes use of the Rothermel-Albini~\cite{Rothermel:1972,Albini:1976} surface fire spread rate formulae and the assumption that a surface fire spreading from a point under certain wind, slope and vegetation conditions does so with an ellipse-shaped fire front with, for a given wind speed, a fixed length-to-breadth ratio~\cite{Richards:1990}.

The level set spread model can be applied in various ways:
\begin{enumerate}
\item Only the level set simulation is performed. The wind is not affected by the terrain, and there is no fire.
\item The wind field is established over the terrain, but it is ``frozen'' when the fire ignites.
\item The wind field follows the terrain, but there is no actual fire in the simulation. It is just front-tracking.
\item The wind and fire are fully-coupled. When the fire front arrives at a given surface cell, it burns for a finite duration and with a heat release per unit area provided as part of the fuel model.
\end{enumerate}
When fully coupled to the CFD model, the level set function acts as an igniter as it reaches a new surface cell. The cell burns for a pre-determined amount of time. For cases where the depth of the fireline is less than the size of a grid cell, the burning time is extended while the burning rate is decreased so as to maintain conservation of fuel mass.





% Here, methodology to get fuels in the terrain from online sources.



% Coupling level set fire spread model with fluid solver.



% Defining atmospheric conditions:
\section{Defining atmospheric wind : The Mean Forcing Concept} \label{sec:wind}

The process of steering the solution of the mass, momentum, and energy equations to match wind speed and direction gathered at random weather stations is known as \emph{data assimilation}~\cite{Kalnay:2003}. FDS uses a relatively simple data assimilation technique, a method known as \emph{nudging}, where you add a forcing term to the momentum equation to ``nudge'' the flow in the direction of the specified wind. FDS automatically drives the mean velocity components toward the desired values by adding a forcing term to the momentum equation. For example, the $u$ component equation is modified as follows:
\begin{equation}
   \frac{\partial u}{\partial t} + \ldots = \frac{u_0(z,t)-\overline{u}(z,t)}{\tau} \label{mean_forcing_u}
\end{equation}
Here, $u(\mathbf{x},t)$ is the computed velocity component, $u_0$ is the specified wind field component that can vary with height and time, and $\overline{u}$ is the average of the computed velocity component at the height $z$. The relaxation time scale, $\tau$, is an important parameter. The shorter this time scale, the faster the flow field will ``catch up'' to the mean wind, but at the expense of possibly washing out important flow structures.

\section{Numerical Experiments} \label{sec:numexp}





\subsection{Simple example}  \label{sec:simexp}




\subsection{Cogoleto Fire}  \label{sec:cogo}




\section{Summary} \label{sec:summary}







\reftitle{References}


\externalbibliography{yes}
\bibliography{Vanella_Article_Atmosphere_2020}


% The following MDPI journals use author-date citation: Arts, Econometrics, Economies, Genealogy, Humanities, IJFS, JRFM, Laws, Religions, Risks, Social Sciences. For those journals, please follow the formatting guidelines on http://www.mdpi.com/authors/references
% To cite two works by the same author: \citeauthor{ref-journal-1a} (\citeyear{ref-journal-1a}, \citeyear{ref-journal-1b}). This produces: Whittaker (1967, 1975)
% To cite two works by the same author with specific pages: \citeauthor{ref-journal-3a} (\citeyear{ref-journal-3a}, p. 328; \citeyear{ref-journal-3b}, p.475). This produces: Wong (1999, p. 328; 2000, p. 475)




%% for journal Sci
%\reviewreports{\\
%Reviewer 1 comments and authors’ response\\
%Reviewer 2 comments and authors’ response\\
%Reviewer 3 comments and authors’ response
%}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\end{document}

